# 人物卡脚本结构分析

### 策划人物卡成分(战斗)    
- 人物名称(characterName)
- 人物基础属性(status)
    - ```HP```=最大生命值
    - ```SP```=最大魔力值
    - ```AP```=最大行动点
    - ```PRA```=操练
    - ```ACA```=学识
    - ```AGI```=敏捷
- 武器
    - 武器名称
    - 武器类型
        - 猎枪||大宝剑
    - 武器阶级
        - 初始武器||进阶武器||终极武器
    - 武器介绍
    - 武器单次攻击所需的魔力消耗
    - 武器攻击范围
    - 武器威力
    - 武器特殊效果
        - 发动条件
            - 在某种行为(普通攻击||普通防御||探索)的情况下
            - 在某种状态(隐身||残疾)下
            - 在某些属性值位于指定区间下
        - 造成效果
            - 增加或减少某一些人物基础属性
            - 增加或减少伤害值(对敌或对己)
            - 增加或消除某些状态
- 技能
    - 技能名称
    - 技能主动性
        - 主动技能需要玩家发动
        - 被动技能自动发动
    - 技能消耗
        - 与技能的初始消耗和技能等级有关
    - 技能目标
        - 自身，友方，敌方(可能复数)
    - 技能效果
        - 对技能目标造成伤害
        - 对技能目标进入或消除某种状态
        - 增加或减少技能目标基础属性
    - 技能习得条件
        - 自带
        - 其他技能到达一定等级
    #### 技能循环
    + 进入该人物的回合，characterCard脚本自检技能列表的合法性
    + 规则层获得人物的合法技能列表(包括所有的技能名称，技能发动函数等)，UI展示技能，监听玩家行为
    + 玩家选择技能，规则层执行函数
    + 挂钩的属性值加上技能熟练度作为最终的阈值
    + characterCard脚本再次自检，循环操作
### characterCard 脚本公开的数据结构
```C#
     [FormerlySerializedAs("character_name")] 
    public string characterName;
    //  角色名
    public Dictionary<string,int> status;
    //  角色属性字典，由于属性值种类不变，直接用键值对取值
    
    public struct state{
        public string name;
        //  状态名
        public int rest_round;
        //  状态剩余回合，若持续状态则为-1
        public string stateCode;
        //  状态效果码
    }
    public List<state> stateList;
    //  状态列表

    public struct weapon{
        public string name;
        //  武器名称
        public string type;
        // 武器种类
        public string weapon_class;
        // 武器阶级(初始，进阶，终极)
        public string description;
        // 武器简介
        public Vector3Int[] attack_area;
        //  武器攻击范围
        public int weapon_power;
        //  武器威力
        public string weaponCode; 
        //  武器特殊效果码
    }
    public List<weapon> weaponList;
    //持有的武器列表

    public struct skill{
        public bool isLeagal;
        //  该技能是否能发动
        public string name;
        //  技能名称
        public int level;
        //  技能等级
        public int skill_PRA;
        //  技能熟练度
        public string description;
        //  展示给用户的技能说明
        public Vector3Int skill_consume;
        //  技能消耗的属性值，分别代表AP(行动点)，HP(血量)，SP（精神力）
        public string linked_status;
        //技能关联属性值
        public string[] skill_target;
        //  技能的目标
        public string skill_effect;
        //  技能的效果码
        public string acquire_condition;
        //  技能的习得条件
    }
    public List<skill> skillList;
    //  技能的列表
```
### 为了实现人物卡所需要的函数
- 人物行为检查函数
- 人物状态临时修改函数
- 索敌函数，周边友方检测函数
- 状态码解释器
- 武器特殊效果码解释器
- 技能效果码解释器
```C#
    public void checkCharacterCard();
    //  人物卡自检函数，检查是否有可习得的新技能，可拥有的新武器等，并且永久化储存

    public dictionary<string,int> getStatus();
    //  获得角色的属性值
    public stateList getStateList();
    //  获得该角色的状态列表
    public weaponList getWeaponList();
    //  获得角色的武器列表
    public skillList getSkillList();
    //  获得角色的技能列表

    public void launchSkill(string skillName,GameObject[] targetGameObject);
    //  技能发动函数，需要伴随一下的几个辅助函数共同使用
    public GameObject[] seekSkillTarget(string skillName);
    //  根据技能效果码，返回技能的有效目标

    public void addSkillPRA(string skillName,int reletivePRA);
    //  增加或减少技能的熟练度
```
### 人物卡效果通用码
- 条件关键词
    - ```status```
        - 如行动点大于3,SP>40
        - ``` status AP > 3,SP > 40;```
    - ```haveState```
        - 如在隐身状态下
        - ```haveState 隐身；```
    - ```skillLevel```
        - 如隐身的熟练度大于10
        - ```skillLevel > 10;```
    - ```mission```
        - 如完成支线任务2021
        - ```mission 2021;```
- 执行关键词
    - ```reletivelyChangeStatus(RCS)```
        - 执行后减3行动点,减40魔法力
        - ```RCS AP - 3;RCS SP - 40;```
    - ```doDamage```
    
    - ```createState```
        - 创建隐身效果level+1个回合
        - ```createState 隐身*(level+1)```
    - ```cancelState```
        - 取消隐身效果
        - ```cancelState 隐身```
